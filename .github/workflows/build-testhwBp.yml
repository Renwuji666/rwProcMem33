name: build-testhwBp

on:
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-22.04
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 1

      - name: install deps
        run: |
          sudo apt-get update
          sudo apt-get install -y unzip make

      - name: download android ndk
        run: |
          NDK_VER=r23c
          curl -L -o android-ndk.zip "https://dl.google.com/android/repository/android-ndk-${NDK_VER}-linux.zip"
          unzip -q android-ndk.zip
          echo "NDK_HOME=$PWD/android-ndk-${NDK_VER}" >> $GITHUB_ENV

      - name: build testHwBp
        run: |
          cd hwBreakpointProcModule/testHwBp
          "$NDK_HOME/ndk-build"

      - name: collect artifacts
        run: |
          mkdir -p artifacts
          cp -v hwBreakpointProcModule/testHwBp/libs/arm64-v8a/testHwBp artifacts/
          ls -la artifacts

      - name: upload artifacts
        uses: actions/upload-artifact@v4
        with:
          name: testHwBp-arm64
          path: artifacts/testHwBp
